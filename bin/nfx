#!/usr/bin/env node

'use strict';

const path = require('path'),
      program = require('commander'),
      deploy = require('../src/deploy'),
      rollback = require('../src/rollback'),
      newProject = require('../src/new'),
      generate = require('../src/generate');

const pkgJSON = require(path.join(__dirname, '..', 'package.json'));

program
  .version(pkgJSON.version)
  .usage('[command]');

program
  .command('new [stackName]')
  .description('setup provider credential')
  .option('-r, --region [region]', 'AWS region')
  .option('-b, --bucket-name [bucketName]', 'AWS bucket name')
  .action((stackName, options) => {
    newProject(stackName, options);
  });

program
  .command('generate <functionName>')
  .description('rollback to the specified version')
  .action((functionName) => {
    generate(functionName);
  });

program
  .command('deploy')
  .description('deploy a project')
  .action(() => {
    deploy(require('../src/session').init());
  });

program
  .command('rollback [version]')
  .description('rollback to the specified version')
  .action((version) => {
    rollback(require('../src/session').init(), version);
  });

program.parse(process.argv);

if (program.args.length === 0) {
  program.outputHelp();
}
